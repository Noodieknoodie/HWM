# 401k Payment Tracker - Complete Test Data Specification
# Shows full data flow: Database → Calculations → UI Display

# ===== DATABASE TABLES (Raw Storage) =====

clients_all:
  - client_id: 1
    display_name: "Acme Corp"
    full_name: "ACME CORPORATION 401(K) PLAN"
    ima_signed_date: "2023-03-15"
    is_deleted: false
    deleted_date: null
  - client_id: 2
    display_name: "TechStart Inc"
    full_name: "TECHSTART INC RETIREMENT PLAN"
    ima_signed_date: "2023-06-01"
    is_deleted: false
    deleted_date: null

contracts:
  - contract_id: 1
    client_id: 1
    contract_number: "JH-2023-1001"
    provider_name: "John Hancock"
    contract_start_date: "2023-03-15"
    fee_type: "percentage"
    percent_rate: 0.001 # STORED: 0.1% as decimal
    flat_rate: null
    payment_schedule: "monthly"
    num_people: 45
    notes: "Standard percentage contract"
  - contract_id: 2
    client_id: 2
    contract_number: "VOYA-2023-2001"
    provider_name: "Voya"
    contract_start_date: "2023-06-01"
    fee_type: "flat"
    percent_rate: null
    flat_rate: 3000 # STORED: $3000 per quarter
    payment_schedule: "quarterly"
    num_people: 12
    notes: "Startup flat fee arrangement"

contacts:
  - contact_id: 1
    client_id: 1
    contact_type: "Primary"
    contact_name: "Jane Smith"
    phone: "206-555-0100"
    email: "jane@acmecorp.com"
    fax: null
    physical_address: "123 Main St, Seattle, WA 98101"
    mailing_address: "PO Box 1234, Seattle, WA 98101"
  - contact_id: 2
    client_id: 1
    contact_type: "Provider"
    contact_name: "Bob Johnson"
    phone: "800-555-1234"
    email: "bob@johnhancock.com"
    fax: "800-555-1235"
    physical_address: "100 Financial Way, Boston, MA 02101"
    mailing_address: null
  - contact_id: 3
    client_id: 2
    contact_type: "Primary"
    contact_name: "Mike Chen"
    phone: "425-555-0200"
    email: "mike@techstart.com"
    fax: null
    physical_address: "456 Tech Blvd, Bellevue, WA 98004"
    mailing_address: null

payments:
  # Acme Corp - Monthly percentage (Q2 2024: April, May, June)
  - payment_id: 101
    contract_id: 1
    client_id: 1
    received_date: "2024-05-15" # Received in May
    total_assets: 4500000 # $4.5M AUM
    actual_fee: 4500 # $4,500 payment
    method: "Check"
    notes: null
    applied_period_type: "monthly"
    applied_period: 4 # For April
    applied_year: 2024
  - payment_id: 102
    contract_id: 1
    client_id: 1
    received_date: "2024-06-14"
    total_assets: 4520000 # Slight increase
    actual_fee: 4520
    method: "Check"
    notes: null
    applied_period_type: "monthly"
    applied_period: 5 # For May
    applied_year: 2024
  - payment_id: 103
    contract_id: 1
    client_id: 1
    received_date: "2024-07-16"
    total_assets: null # MISSING AUM - will trigger estimation
    actual_fee: 4530
    method: "ACH"
    notes: "Provider didn't include AUM"
    applied_period_type: "monthly"
    applied_period: 6 # For June
    applied_year: 2024
  # TechStart Inc - Quarterly flat (Q2 2024)
  - payment_id: 201
    contract_id: 2
    client_id: 2
    received_date: "2024-07-10"
    total_assets: 1200000 # AUM doesn't affect flat fee
    actual_fee: 3000 # Exactly as contracted
    method: "Wire Transfer"
    notes: null
    applied_period_type: "quarterly"
    applied_period: 2 # Q2
    applied_year: 2024

payment_periods:
  # Just showing relevant periods for our test data
  - period_type: "monthly"
    year: 2024
    period: 4
    period_name: "April 2024"
    start_date: "2024-04-01"
    end_date: "2024-04-30"
    is_current: false
  - period_type: "monthly"
    year: 2024
    period: 5
    period_name: "May 2024"
    start_date: "2024-05-01"
    end_date: "2024-05-31"
    is_current: false
  - period_type: "monthly"
    year: 2024
    period: 6
    period_name: "June 2024"
    start_date: "2024-06-01"
    end_date: "2024-06-30"
    is_current: false
  - period_type: "quarterly"
    year: 2024
    period: 2
    period_name: "Q2 2024"
    start_date: "2024-04-01"
    end_date: "2024-06-30"
    is_current: false

quarterly_notes:
  - client_id: 1
    year: 2024
    quarter: 2
    notes: "June payment missing AUM due to provider system issue"
    last_updated: "2024-07-20 10:30:00"
    updated_by: "dodd@hwm.com"
  - client_id: 2
    year: 2024
    quarter: 2
    notes: null
    last_updated: null
    updated_by: null

client_quarter_markers:
  - client_id: 1
    year: 2024
    quarter: 2
    is_posted: true # Dodd reviewed Q2 for Acme
    created_date: "2024-07-20 10:35:00"
    modified_date: "2024-07-20 10:35:00"
  - client_id: 2
    year: 2024
    quarter: 2
    is_posted: false # Not yet reviewed
    created_date: "2024-07-10 14:00:00"
    modified_date: "2024-07-10 14:00:00"

variance_thresholds:
  - threshold_type: "exact"
    max_percent: 0.01 # $0.01 threshold (stored as percent for consistency)
    display_order: 1
    description: "Within one cent"
    modified_date: "2024-01-01"
    modified_by: "system"
  - threshold_type: "acceptable"
    max_percent: 5.00
    display_order: 2
    description: "Within 5% variance"
    modified_date: "2024-01-01"
    modified_by: "system"
  - threshold_type: "warning"
    max_percent: 15.00
    display_order: 3
    description: "Within 15% variance"
    modified_date: "2024-01-01"
    modified_by: "system"

# ===== CALCULATIONS & DISPLAY =====

acme_calculations:
  # Dashboard Display (assuming viewed in July 2024)
  current_billable_period:
    calculation: "getCurrentBillablePeriod(Date('2024-07-15'), 'monthly')"
    result: { period: 6, year: 2024 } # June 2024 (arrears)
    display: "June 2024"
    ui_location: "CurrentStatusCard main value"
  payment_status:
    last_payment: { period: 6, year: 2024 }
    current_period: { period: 6, year: 2024 }
    result: "Paid"
    ui_location: "CurrentStatusCard - no 'Awaiting Entry' shown"
  # Rate Conversions
  stored_rate: 0.001 # As decimal
  rate_conversions:
    calculation: "convertRates(0.001, 'monthly', 'percentage')"
    result:
      monthly: 0.001 # 0.1%
      quarterly: 0.003 # 0.3%
      annual: 0.012 # 1.2%
    display:
      monthly: "0.10%"
      quarterly: "0.30%"
      annual: "1.20%"
    ui_location: "AssetsAndFeesCard rate badges"
  # Payment History Calculations
  april_payment:
    expected_fee:
      calculation: "calculateExpectedFee('percentage', 0.001, null, 4500000)"
      result: 4500 # $4.5M × 0.1% = $4,500
    variance:
      amount: 0 # $4,500 - $4,500
      percent: 0 # 0%
      status: "exact"
    ui_display: "$4,500 expected, no variance indicator"
  may_payment:
    expected_fee: 4520 # $4.52M × 0.1%
    variance:
      amount: 0
      percent: 0
      status: "exact"
  june_payment_with_missing_aum:
    aum_estimation:
      calculation: "estimateAum(4530, 0.001)"
      result: 4530000 # $4.53M estimated
    expected_fee:
      calculation: "calculateExpectedFee('percentage', 0.001, null, null)"
      result: null # Can't calculate without AUM
    variance:
      calculation: "getVarianceStatus(4530, null, true, true)"
      result: "unknown" # Because AUM is estimated
    ui_display:
      aum: "$4,530,000*" # Asterisk shows estimation
      variance: "N/A - Est. AUM" # Not a zero variance
  # Quarterly Summary Display
  q2_summary:
    payments: [4500, 4520, 4530]
    actual_total: 13550
    expected_total: null # One payment has estimated AUM
    variance: null
    variance_status: "unknown"
    payment_count: "3/3" # All 3 monthly payments received
    posted: true # client_quarter_markers.is_posted
    ui_location: "Summary page quarterly view"

techstart_calculations:
  # Dashboard Display
  current_billable_period:
    calculation: "getCurrentBillablePeriod(Date('2024-07-15'), 'quarterly')"
    result: { period: 2, year: 2024 } # Q2 2024
    display: "Q2 2024"
  payment_status: "Paid"
  # Rate Display (flat fee)
  stored_rate: 3000 # Quarterly rate
  rate_conversions:
    calculation: "convertRates(3000, 'quarterly', 'flat')"
    result:
      monthly: 1000 # $1,000/month equivalent
      quarterly: 3000 # $3,000/quarter
      annual: 12000 # $12,000/year
    display:
      monthly: "$1,000"
      quarterly: "$3,000"
      annual: "$12,000"
  # Payment Calculation
  q2_payment:
    expected_fee:
      calculation: "calculateExpectedFee('flat', null, 3000, 1200000)"
      result: 3000 # Flat fee ignores AUM
    variance:
      amount: 0 # $3,000 - $3,000
      percent: 0
      status: "exact"
    ui_display: "No variance indicator shown"
  # Summary Display
  q2_summary:
    actual: 3000
    expected: 3000
    variance: 0
    variance_status: "exact"
    payment_count: "1/1" # 1 quarterly payment
    posted: false # Not yet reviewed

# ===== UI LOCATIONS REFERENCE =====
ui_component_mapping:
  dashboard_cards:
    CurrentStatusCard:
      - current_period_display # "June 2024" or "Q2 2024"
      - payment_status # Shows "Awaiting Entry" if Due
      - expected_fee # Calculated from current data
    AssetsAndFeesCard:
      - aum_display # With * if estimated
      - rate_badges # M/Q/A rates converted
    PlanDetailsCard:
      - provider_name # Direct from contract
      - num_people # Direct from contract
    ContactCard:
      - primary_contact # From contacts table
  payment_history:
    - expected_fee_column # Calculated per row
    - variance_column # Shows "N/A - Est. AUM" when applicable
    - variance_indicator # Amber dot for high variance
  summary_page:
    quarterly_view:
      - provider_totals # Aggregated from clients
      - client_rows # With variance status coloring
      - posted_checkboxes # From client_quarter_markers
      - quarterly_notes # Inline with expand icon
    annual_view:
      - q1_q2_q3_q4_columns # Accumulated from payments
      - annual_totals # Sum of quarters
